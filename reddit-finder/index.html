<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Viral Topic Finder</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #f0eeeb;
      --white: #ffffff;
      --surface: #f7f6f4;
      --border: #e0ddd9;
      --text: #1a1a1a;
      --muted: #888580;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Cormorant Garamond', Georgia, serif;
      min-height: 100vh;
    }

    .container {
      max-width: 780px;
      margin: 0 auto;
      padding: 0 28px;
    }

    header {
      padding: 72px 0 52px;
      text-align: center;
    }

    .eyebrow {
      font-size: 11px;
      font-weight: 300;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 22px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .eyebrow::before, .eyebrow::after {
      content: '';
      display: inline-block;
      width: 32px;
      height: 1px;
      background: var(--border);
    }

    h1 {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: clamp(2.8rem, 7vw, 5rem);
      font-weight: 700;
      line-height: 1.0;
      letter-spacing: -0.01em;
      color: var(--text);
      margin-bottom: 18px;
    }

    .subtitle {
      color: var(--muted);
      font-size: 1.15rem;
      font-weight: 300;
      font-style: italic;
      line-height: 1.6;
      max-width: 400px;
      margin: 0 auto;
    }

    .divider {
      width: 48px;
      height: 1px;
      background: var(--border);
      margin: 24px auto 0;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 0;
      margin: 44px 0 0;
      border-bottom: 1px solid var(--border);
    }

    .tab-btn {
      background: none;
      border: none;
      border-bottom: 2px solid transparent;
      margin-bottom: -1px;
      padding: 12px 24px;
      font-family: 'Cormorant Garamond', serif;
      font-size: 0.8rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--muted);
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .tab-btn:hover { color: var(--text); }

    .tab-btn.active {
      color: var(--text);
      border-bottom-color: var(--text);
    }

    .saved-count {
      background: var(--text);
      color: white;
      font-size: 9px;
      border-radius: 999px;
      padding: 2px 7px;
      letter-spacing: 0;
    }

    /* Search */
    .search-wrap { margin: 28px 0 16px; }

    .search-box {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .search-box input {
      flex: 1;
      background: var(--white);
      border: 1px solid var(--border);
      border-radius: 999px;
      outline: none;
      padding: 16px 24px;
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.1rem;
      color: var(--text);
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .search-box input:focus {
      border-color: var(--text);
      box-shadow: 0 0 0 3px rgba(26,26,26,0.07);
    }

    .search-box input::placeholder { color: var(--muted); font-style: italic; }

    .search-box button {
      background: var(--white);
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 16px 30px;
      color: var(--text);
      font-family: 'Cormorant Garamond', serif;
      font-size: 0.75rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .search-box button:hover {
      background: var(--text);
      color: white;
      border-color: var(--text);
    }

    .filters {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 14px;
      align-items: center;
    }

    .filter-label {
      font-size: 10px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .filter-btn {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--muted);
      font-family: 'Cormorant Garamond', serif;
      font-size: 0.78rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      padding: 6px 18px;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .filter-btn:hover, .filter-btn.active {
      background: var(--text);
      border-color: var(--text);
      color: white;
    }

    .loading { display: none; text-align: center; padding: 48px 0; }
    .loading.show { display: block; }

    .spinner {
      width: 28px;
      height: 28px;
      border: 1px solid var(--border);
      border-top-color: var(--text);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin { to { transform: rotate(360deg); } }
    .loading p { color: var(--muted); font-size: 0.9rem; font-style: italic; }

    .results-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }

    .results-title {
      font-size: 10px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .results-title span { color: var(--text); }

    .count-badge {
      font-size: 10px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .results { display: flex; flex-direction: column; gap: 12px; }

    /* Card */
    .card {
      background: var(--white);
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
      transition: border-color 0.2s, box-shadow 0.2s;
      animation: fadeUp 0.3s ease both;
      position: relative;
    }

    .card:hover {
      border-color: #ccc;
      box-shadow: 0 4px 20px rgba(0,0,0,0.07);
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .card:nth-child(2) { animation-delay: 0.05s; }
    .card:nth-child(3) { animation-delay: 0.1s; }
    .card:nth-child(4) { animation-delay: 0.15s; }
    .card:nth-child(5) { animation-delay: 0.2s; }

    .card-link {
      display: block;
      text-decoration: none;
      color: inherit;
    }

    .card-inner { display: flex; }

    .card-image {
      width: 160px;
      min-width: 160px;
      height: 140px;
      object-fit: cover;
      display: block;
      flex-shrink: 0;
    }

    .card-body {
      padding: 20px 52px 20px 24px;
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      gap: 14px;
    }

    .card-top {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 16px;
    }

    .card-title {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 1.0rem;
      font-weight: 400;
      line-height: 1.45;
      color: var(--text);
      flex: 1;
    }

    .viral-badge {
      font-size: 9px;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--text);
      border: 1px solid var(--border);
      padding: 4px 10px;
      border-radius: 999px;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .card-meta {
      display: flex;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .meta-item {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.82rem;
      color: var(--muted);
      font-style: italic;
    }

    .meta-item .val { color: var(--text); font-style: normal; }

    .subreddit-tag {
      margin-left: auto;
      font-size: 10px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .idea-box {
      padding: 12px 20px;
      background: var(--surface);
      border-top: 1px solid var(--border);
    }

    .idea-label {
      font-size: 9px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .idea-box p {
      font-size: 0.85rem;
      color: var(--muted);
      font-style: italic;
      line-height: 1.5;
    }

    /* Like button */
    .like-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      background: var(--white);
      border: 1px solid var(--border);
      border-radius: 999px;
      width: 34px;
      height: 34px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
      z-index: 2;
      line-height: 1;
    }

    .like-btn:hover {
      border-color: #ccc;
      transform: scale(1.1);
    }

    .like-btn.liked {
      background: #fff0f0;
      border-color: #f4b8b8;
    }

    /* Saved view */
    .saved-view { display: none; }
    .saved-view.show { display: block; }

    .discover-view { display: block; }
    .discover-view.hide { display: none; }

    .empty-saved {
      text-align: center;
      padding: 72px 0;
      color: var(--muted);
    }

    .empty-saved .icon { font-size: 1.8rem; margin-bottom: 14px; opacity: 0.3; }
    .empty-saved p { font-style: italic; font-size: 1rem; }

    .error-msg {
      display: none;
      text-align: center;
      padding: 36px;
      color: var(--muted);
      background: var(--white);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-style: italic;
    }

    .error-msg.show { display: block; }

    footer {
      text-align: center;
      padding: 64px 0 44px;
      color: var(--muted);
      font-size: 0.78rem;
      letter-spacing: 0.08em;
    }

    footer a { color: var(--text); text-decoration: none; }

    footer::before {
      content: '';
      display: block;
      width: 40px;
      height: 1px;
      background: var(--border);
      margin: 0 auto 24px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="eyebrow">Live Reddit Data</div>
      <h1>Viral Topic Finder</h1>
      <p class="subtitle">Search any topic and see what's trending on Reddit right now.</p>
      <div class="divider"></div>
    </header>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-btn active" onclick="showTab('discover')">Discover</button>
      <button class="tab-btn" id="savedTab" onclick="showTab('saved')">
        Saved <span class="saved-count" id="savedCount">0</span>
      </button>
    </div>

    <!-- Discover view -->
    <div class="discover-view" id="discoverView">
      <div class="search-wrap">
        <div class="search-box">
          <input type="text" id="searchInput" placeholder="Try: skincare, AI tools, startups, hästar..." />
          <button onclick="search()">Search</button>
        </div>
        <div class="filters">
          <span class="filter-label">Sort by</span>
          <button class="filter-btn active" onclick="setSort('hot', this)">Hot</button>
          <button class="filter-btn" onclick="setSort('top', this)">Top</button>
          <button class="filter-btn" onclick="setSort('new', this)">New</button>
        </div>
      </div>

      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Loading trending posts...</p>
      </div>

      <div class="error-msg" id="errorMsg">
        Something went wrong. Reddit may be rate limiting — please try again in a moment.
      </div>

      <div class="results-header" id="resultsHeader">
        <div class="results-title" id="resultsTitle">What's <span>trending right now</span></div>
        <div class="count-badge" id="countBadge"></div>
      </div>

      <div class="results" id="results"></div>
    </div>

    <!-- Saved view -->
    <div class="saved-view" id="savedView">
      <div class="results-header" style="margin-top: 28px;">
        <div class="results-title">Your <span>saved posts</span></div>
        <div class="count-badge" id="savedCountLabel"></div>
      </div>
      <div class="empty-saved" id="emptySaved">
        <div class="icon">♡</div>
        <p>You haven't saved any posts yet — hit the heart on posts you love!</p>
      </div>
      <div class="results" id="savedResults"></div>
    </div>

    <footer>
      Powered by the <a href="https://www.reddit.com/dev/api/" target="_blank">Reddit API</a> · Data refreshed on each search
    </footer>
  </div>

  <script>
    let currentSort = 'hot';
    let currentQuery = '';
    let liked = JSON.parse(localStorage.getItem('vtf_liked') || '{}');

    function saveLiked() {
      localStorage.setItem('vtf_liked', JSON.stringify(liked));
      updateSavedCount();
    }

    function updateSavedCount() {
      const count = Object.keys(liked).length;
      document.getElementById('savedCount').textContent = count;
    }

    function showTab(tab) {
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      if (tab === 'discover') {
        document.querySelectorAll('.tab-btn')[0].classList.add('active');
        document.getElementById('discoverView').classList.remove('hide');
        document.getElementById('savedView').classList.remove('show');
      } else {
        document.querySelectorAll('.tab-btn')[1].classList.add('active');
        document.getElementById('discoverView').classList.add('hide');
        document.getElementById('savedView').classList.add('show');
        renderSaved();
      }
    }

    function setSort(sort, btn) {
      currentSort = sort;
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      loadPosts();
    }

    document.getElementById('searchInput').addEventListener('keydown', e => {
      if (e.key === 'Enter') search();
    });

    function formatNumber(n) {
      if (n >= 1000) return (n / 1000).toFixed(1) + 'k';
      return n;
    }

    function getViralBadge(score) {
      if (score > 50000) return 'Mega Viral';
      if (score > 10000) return 'Viral';
      if (score > 3000)  return 'Trending';
      if (score > 500)   return 'Rising';
      return null;
    }

    function getContentIdea(post) {
      const title = post.title.toLowerCase();
      if (post.num_comments > 500) return `High-debate post — this topic sparks conversation. Great angle for a "controversial take" content piece.`;
      if (post.score > 20000) return `Massive reach on r/${post.subreddit} — this topic resonates with a large audience right now.`;
      if (title.includes('?')) return `People are asking questions about this — a how-to or explainer post could perform really well.`;
      return `Trending in r/${post.subreddit} — consider creating content that taps into this conversation.`;
    }

    function getThumbnail(post) {
      if (post.preview && post.preview.images && post.preview.images[0]) {
        const resolutions = post.preview.images[0].resolutions;
        if (resolutions && resolutions.length > 0) {
          return resolutions[Math.min(2, resolutions.length - 1)].url.replace(/&amp;/g, '&');
        }
      }
      if (post.thumbnail && post.thumbnail.startsWith('http')) {
        return post.thumbnail;
      }
      return null;
    }

    function createCard(post, isSavedView = false) {
      const badge = getViralBadge(post.score);
      const idea = getContentIdea(post);
      const thumb = getThumbnail(post);
      const isLiked = !!liked[post.id];

      const card = document.createElement('div');
      card.className = 'card';
      card.id = `card-${post.id}`;
      card.innerHTML = `
        <a class="card-link" href="https://reddit.com${post.permalink}" target="_blank" rel="noopener noreferrer">
          <div class="card-inner">
            ${thumb ? `<img class="card-image" src="${thumb}" alt="" onerror="this.style.display='none'"/>` : ''}
            <div class="card-body">
              <div class="card-top">
                <div class="card-title">${post.title}</div>
                ${badge ? `<div class="viral-badge">${badge}</div>` : ''}
              </div>
              <div class="card-meta">
                <div class="meta-item">
                  <span>↑</span>
                  <span class="val">${formatNumber(post.score)}</span>
                  <span>upvotes</span>
                </div>
                <div class="meta-item">
                  <span>◯</span>
                  <span class="val">${formatNumber(post.num_comments)}</span>
                  <span>comments</span>
                </div>
                <div class="subreddit-tag">r/${post.subreddit}</div>
              </div>
            </div>
          </div>
          <div class="idea-box">
            <div class="idea-label">Content Idea</div>
            <p>${idea}</p>
          </div>
        </a>
        <button class="like-btn ${isLiked ? 'liked' : ''}" onclick="toggleLike(event, '${post.id}')" title="${isLiked ? 'Remove from saved' : 'Save post'}">
          ${isLiked ? '♥' : '♡'}
        </button>
      `;
      return card;
    }

    function toggleLike(e, postId) {
      e.stopPropagation();
      e.preventDefault();

      if (liked[postId]) {
        delete liked[postId];
      } else {
        // Find post data from DOM to save
        const card = document.getElementById(`card-${postId}`);
        if (card) {
          liked[postId] = { id: postId, _savedAt: Date.now() };
        }
      }

      // Update all buttons with this postId on page
      document.querySelectorAll(`#card-${postId} .like-btn`).forEach(btn => {
        btn.classList.toggle('liked', !!liked[postId]);
        btn.textContent = liked[postId] ? '♥' : '♡';
        btn.title = liked[postId] ? 'Remove from saved' : 'Save post';
      });

      saveLiked();
    }

    function renderSaved() {
      const savedContainer = document.getElementById('savedResults');
      const emptyMsg = document.getElementById('emptySaved');
      const countLabel = document.getElementById('savedCountLabel');
      savedContainer.innerHTML = '';

      const keys = Object.keys(liked);
      countLabel.textContent = `${keys.length} post${keys.length !== 1 ? 's' : ''}`;

      if (keys.length === 0) {
        emptyMsg.style.display = 'block';
        return;
      }

      emptyMsg.style.display = 'none';

      // Re-fetch saved posts from Reddit by their IDs
      const ids = keys.join(',');
      fetch(`https://www.reddit.com/by_id/${keys.map(id => 't3_' + id).join(',')}.json`)
        .then(r => r.json())
        .then(data => {
          const posts = data.data.children.map(c => c.data);
          posts.forEach(post => {
            savedContainer.appendChild(createCard(post, true));
          });
        })
        .catch(() => {
          savedContainer.innerHTML = '<p style="color:var(--muted);font-style:italic;text-align:center;padding:24px">Could not load saved posts right now.</p>';
        });
    }

    async function loadPosts() {
      document.getElementById('errorMsg').classList.remove('show');
      document.getElementById('results').innerHTML = '';
      document.getElementById('loading').classList.add('show');

      try {
        let url;
        if (currentQuery) {
          url = `https://www.reddit.com/search.json?q=${encodeURIComponent(currentQuery)}&sort=${currentSort}&limit=10&t=week`;
        } else {
          url = `https://www.reddit.com/${currentSort}.json?limit=10`;
        }

        const res = await fetch(url, { headers: { 'Accept': 'application/json' } });
        if (!res.ok) throw new Error('Reddit API error');
        const data = await res.json();
        const posts = data.data.children.map(c => c.data);

        document.getElementById('loading').classList.remove('show');

        const title = document.getElementById('resultsTitle');
        document.getElementById('countBadge').textContent = `${posts.length} posts`;

        if (currentQuery) {
          title.innerHTML = `Results for <span>"${currentQuery}"</span>`;
        } else {
          title.innerHTML = `What's <span>trending right now</span>`;
        }

        const container = document.getElementById('results');
        posts.forEach(post => container.appendChild(createCard(post)));

      } catch (err) {
        document.getElementById('loading').classList.remove('show');
        document.getElementById('errorMsg').classList.add('show');
      }
    }

    function search() {
      currentQuery = document.getElementById('searchInput').value.trim();
      loadPosts();
    }

    updateSavedCount();
    loadPosts();
  </script>
</body>
</html>